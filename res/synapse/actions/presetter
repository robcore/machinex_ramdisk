BB=busybox;

if [ -d /data/data/com.af.synapse ]; then
  SYNAPSE_PRESET_DIR=/data/.machinex/saved_presets;
  SYNAPSE_DATA=/data/data/com.af.synapse;

  [ ! -d "$SYNAPSE_PRESET_DIR" ] && mkdir -p "$SYNAPSE_PRESET_DIR";
  [ ! -f "$SYNAPSE_PRESET_DIR/.selected_preset_profile" -o -z `cat "$SYNAPSE_PRESET_DIR/.selected_preset_profile"` ] && echo "None" > "$SYNAPSE_PRESET_DIR/.selected_preset_profile";

  SYNAPSE_PRESET_FILE=$SYNAPSE_PRESET_DIR/.selected_preset_profile;
  SYNAPSE_PRESET_PROFILE=`cat $SYNAPSE_PRESET_FILE`;
fi;

resetter() {
  $BB rm -f $SYNAPSE_DATA/cache/*
  $BB rm -f $SYNAPSE_DATA/databases/*
  $BB rm -f $SYNAPSE_DATA/files/*
  /sbin/uci reset
  /sbin/uci
  am force-stop com.af.synapse 2> /dev/null
}

case "$1" in
rolloyoujerk)
	if [ ! -z $2 ]; then
		if [ $2 == 0 ]; then
			echo None > $SYNAPSE_PRESET_FILE
		elif [ $2 == 1 ]; then
			echo PERFORMANCE > $SYNAPSE_PRESET_FILE
			echo machinactive > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
			echo 0 > /sys/devices/virtual/misc/mako_hotplug_control/enabled
			echo 0 > /sys/devices/system/cpu/cpu0/rq-stats/hotplug_enable
			echo 0 > /sys/module/msm_hotplug/msm_enabled
			echo 0 > /sys/kernel/msm_mpdecision/conf/enabled
			echo 0 > /sys/devices/platform/msm_sleeper/enabled
			echo 0 > /sys/module/lazyplug/parameters/lazyplug_active
			echo 0 > /sys/kernel/alucard_hotplug/hotplug_enable
			echo 0 > /sys/module/blu_plug/parameters/enabled
			echo 1 > /sys/kernel/intelli_plug/intelli_plug_active
			echo 1 > /sys/kernel/intelli_plug/full_mode_profile
			echo 4 > /sys/kernel/intelli_plug/cpus_boosted;
			echo 2 > /sys/kernel/intelli_plug/min_cpus_online
			echo Y > /sys/module/cpu_boost/parameters/input_boost_enabled
			echo N > /sys/module/cpu_boost/parameters/hotplug_boost
			echo 1350000 > /sys/module/cpu_boost/parameters/input_boost_freq
			echo 70 > /sys/module/msm_thermal/parameters/limit_temp_degC
			echo 80 > /sys/module/msm_thermal/parameters/core_limit_temp_degC
			echo 450000000 > /sys/devices/platform/kgsl-3d0.0/kgsl/kgsl-3d0/max_gpuclk
			echo trustzone > /sys/devices/platform/kgsl-3d0.0/kgsl/kgsl-3d0/pwrscale/policy
			echo ondemand > /sys/devices/platform/kgsl-3d0.0/kgsl/kgsl-3d0/pwrscale/policy_config/trustzone/governor
			echo cfq > /sys/block/mmcblk0/queue/scheduler
			echo 128 > /sys/block/mmcblk0/queue/read_ahead_kb
			if [ -e /sys/block/mmcblk1/queue/scheduler ]; then
				echo cfq > /sys/block/mmcblk1/queue/scheduler
				echo 128 > /sys/block/mmcblk1/queue/read_ahead_kb
			fi
			resetter
		elif [ $2 == 2 ]; then
			echo BALANCED-OD > $SYNAPSE_PRESET_FILE
			echo ondemand > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
			echo 0 > /sys/devices/virtual/misc/mako_hotplug_control/enabled
			echo 0 > /sys/devices/system/cpu/cpu0/rq-stats/hotplug_enable
			echo 0 > /sys/module/msm_hotplug/msm_enabled
			echo 0 > /sys/kernel/msm_mpdecision/conf/enabled
			echo 0 > /sys/devices/platform/msm_sleeper/enabled
			echo 0 > /sys/module/lazyplug/parameters/lazyplug_active
			echo 0 > /sys/kernel/alucard_hotplug/hotplug_enable
			echo 0 > /sys/module/blu_plug/parameters/enabled
			echo 1 > /sys/kernel/intelli_plug/intelli_plug_active
			echo 0 > /sys/kernel/intelli_plug/full_mode_profile
			echo 2 > /sys/kernel/intelli_plug/cpus_boosted;
			echo 1 > /sys/kernel/intelli_plug/min_cpus_online
			echo Y > /sys/module/cpu_boost/parameters/input_boost_enabled
			echo N > /sys/module/cpu_boost/parameters/hotplug_boost
			echo 1350000 > /sys/module/cpu_boost/parameters/input_boost_freq
			echo 70 > /sys/module/msm_thermal/parameters/limit_temp_degC
			echo 80 > /sys/module/msm_thermal/parameters/core_limit_temp_degC
			echo 450000000 > /sys/devices/platform/kgsl-3d0.0/kgsl/kgsl-3d0/max_gpuclk
			echo trustzone > /sys/devices/platform/kgsl-3d0.0/kgsl/kgsl-3d0/pwrscale/policy
			echo ondemand > /sys/devices/platform/kgsl-3d0.0/kgsl/kgsl-3d0/pwrscale/policy_config/trustzone/governor
			echo cfq > /sys/block/mmcblk0/queue/scheduler
			echo 128 > /sys/block/mmcblk0/queue/read_ahead_kb
			if [ -e /sys/block/mmcblk1/queue/scheduler ]; then
				echo cfq > /sys/block/mmcblk1/queue/scheduler
				echo 128 > /sys/block/mmcblk1/queue/read_ahead_kb
			fi
			resetter
		elif [ $2 == 3 ]; then
			echo BALANCED-INT > $SYNAPSE_PRESET_FILE
			echo interactive > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
			echo 0 > /sys/devices/virtual/misc/mako_hotplug_control/enabled
			echo 0 > /sys/devices/system/cpu/cpu0/rq-stats/hotplug_enable
			echo 0 > /sys/module/msm_hotplug/msm_enabled
			echo 0 > /sys/kernel/msm_mpdecision/conf/enabled
			echo 0 > /sys/devices/platform/msm_sleeper/enabled
			echo 0 > /sys/module/lazyplug/parameters/lazyplug_active
			echo 0 > /sys/kernel/alucard_hotplug/hotplug_enable
			echo 0 > /sys/module/blu_plug/parameters/enabled
			echo 1 > /sys/kernel/intelli_plug/intelli_plug_active
			echo 0 > /sys/kernel/intelli_plug/full_mode_profile
			echo 2 > /sys/kernel/intelli_plug/cpus_boosted;
			echo 1 > /sys/kernel/intelli_plug/min_cpus_online
			echo Y > /sys/module/cpu_boost/parameters/input_boost_enabled
			echo N > /sys/module/cpu_boost/parameters/hotplug_boost
			echo 1350000 > /sys/module/cpu_boost/parameters/input_boost_freq
			echo 70 > /sys/module/msm_thermal/parameters/limit_temp_degC
			echo 80 > /sys/module/msm_thermal/parameters/core_limit_temp_degC
			echo 450000000 > /sys/devices/platform/kgsl-3d0.0/kgsl/kgsl-3d0/max_gpuclk
			echo trustzone > /sys/devices/platform/kgsl-3d0.0/kgsl/kgsl-3d0/pwrscale/policy
			echo ondemand > /sys/devices/platform/kgsl-3d0.0/kgsl/kgsl-3d0/pwrscale/policy_config/trustzone/governor
			echo cfq > /sys/block/mmcblk0/queue/scheduler
			echo 128 > /sys/block/mmcblk0/queue/read_ahead_kb
			if [ -e /sys/block/mmcblk1/queue/scheduler ]; then
				echo cfq > /sys/block/mmcblk1/queue/scheduler
				echo 128 > /sys/block/mmcblk1/queue/read_ahead_kb
			fi
			resetter
		elif [ $2 == 4 ]; then
			echo BATTERY-SAVER > $SYNAPSE_PRESET_FILE
			echo preservative > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
			echo 0 > /sys/devices/virtual/misc/mako_hotplug_control/enabled
			echo 0 > /sys/devices/system/cpu/cpu0/rq-stats/hotplug_enable
			echo 0 > /sys/module/msm_hotplug/msm_enabled
			echo 0 > /sys/kernel/msm_mpdecision/conf/enabled
			echo 0 > /sys/devices/platform/msm_sleeper/enabled
			echo 0 > /sys/module/lazyplug/parameters/lazyplug_active
			echo 0 > /sys/kernel/alucard_hotplug/hotplug_enable
			echo 0 > /sys/module/blu_plug/parameters/enabled
			echo 1 > /sys/kernel/intelli_plug/intelli_plug_active
			echo 2 > /sys/kernel/intelli_plug/full_mode_profile
			echo 1 > /sys/kernel/intelli_plug/cpus_boosted;
			echo 1 > /sys/kernel/intelli_plug/min_cpus_online
			echo Y > /sys/module/cpu_boost/parameters/input_boost_enabled
			echo N > /sys/module/cpu_boost/parameters/hotplug_boost
			echo 1350000 > /sys/module/cpu_boost/parameters/input_boost_freq
			echo 70 > /sys/module/msm_thermal/parameters/limit_temp_degC
			echo 80 > /sys/module/msm_thermal/parameters/core_limit_temp_degC
			echo 450000000 > /sys/devices/platform/kgsl-3d0.0/kgsl/kgsl-3d0/max_gpuclk
			echo trustzone > /sys/devices/platform/kgsl-3d0.0/kgsl/kgsl-3d0/pwrscale/policy
			echo ondemand > /sys/devices/platform/kgsl-3d0.0/kgsl/kgsl-3d0/pwrscale/policy_config/trustzone/governor
			echo cfq > /sys/block/mmcblk0/queue/scheduler
			echo 128 > /sys/block/mmcblk0/queue/read_ahead_kb
			if [ -e /sys/block/mmcblk1/queue/scheduler ]; then
				echo cfq > /sys/block/mmcblk1/queue/scheduler
				echo 128 > /sys/block/mmcblk1/queue/read_ahead_kb
			fi
			resetter
		elif [ $2 == 5 ]; then
			echo ROLLOS-BATTERY-SAVER > $SYNAPSE_PRESET_FILE
			echo preservative > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
			echo 0 > /sys/devices/virtual/misc/mako_hotplug_control/enabled
			echo 0 > /sys/devices/system/cpu/cpu0/rq-stats/hotplug_enable
			echo 0 > /sys/module/msm_hotplug/msm_enabled
			echo 0 > /sys/kernel/msm_mpdecision/conf/enabled
			echo 0 > /sys/devices/platform/msm_sleeper/enabled
			echo 0 > /sys/module/lazyplug/parameters/lazyplug_active
			echo 0 > /sys/kernel/alucard_hotplug/hotplug_enable
			echo 0 > /sys/module/blu_plug/parameters/enabled
			echo 1 > /sys/kernel/intelli_plug/intelli_plug_active
			echo 0 > /sys/kernel/intelli_plug/full_mode_profile
			echo 1 > /sys/kernel/intelli_plug/cpus_boosted;
			echo 1 > /sys/kernel/intelli_plug/min_cpus_online
			echo 1350000 > /sys/module/cpu_boost/parameters/input_boost_freq
			echo N > /sys/module/cpu_boost/parameters/hotplug_boost
			echo N > /sys/module/cpu_boost/parameters/input_boost_enabled
			echo 1350000 > /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
			echo 1350000 > /sys/kernel/cpufreq_hardlimit/scaling_max_freq_screen_on
			echo 1350000 > /sys/kernel/cpufreq_hardlimit/scaling_max_freq_screen_off
			echo 65 > /sys/module/msm_thermal/parameters/limit_temp_degC
			echo 60 > /sys/module/msm_thermal/parameters/core_limit_temp_degC
			echo machinactive > /sys/devices/platform/kgsl-3d0.0/kgsl/kgsl-3d0/pwrscale/policy
			echo 1 > /sys/devices/platform/kgsl-3d0.0/kgsl/kgsl-3d0/pwrscale/policy_config/machinactive/policy_scale_mode
			echo 200000000 > /sys/devices/platform/kgsl-3d0.0/kgsl/kgsl-3d0/max_gpuclk
			echo noop > /sys/block/mmcblk0/queue/scheduler
			echo 256 > /sys/block/mmcblk0/queue/read_ahead_kb
			if [ -e /sys/block/mmcblk1/queue/scheduler ]; then
				echo noop > /sys/block/mmcblk1/queue/scheduler
				echo 256 > /sys/block/mmcblk1/queue/read_ahead_kb
			fi
			resetter
		fi
	fi
	if [ "$SYNAPSE_PRESET_PROFILE" == "None" ]; then
		echo 0
	elif [ "$SYNAPSE_PRESET_PROFILE" == "PERFORMANCE" ]; then
		echo 1
	elif [ "$SYNAPSE_PRESET_PROFILE" == "BALANCED-OD" ]; then
		echo 2
	elif [ "$SYNAPSE_PRESET_PROFILE" == "BALANCED-INT" ]; then
		echo 3
	elif [ "$SYNAPSE_PRESET_PROFILE" == "BATTERY-SAVER" ]; then
		echo 4
	elif [ "$SYNAPSE_PRESET_PROFILE" == "ROLLOS-BATTERY-SAVER" ]; then
		echo 5
	fi
;;

defaults)
	if [ -e /system/robcore ]; then
		echo machinactive > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
	else
		echo interactive > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
	fi
	echo 1890000 > /sys/kernel/cpufreq_hardlimit/scaling_max_freq_screen_on
	echo 1890000 > /sys/kernel/cpufreq_hardlimit/scaling_max_freq_screen_off
	echo 1890000 > /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
	echo Y > /sys/module/cpu_boost/parameters/input_boost_enabled
	echo 0 > /sys/devices/virtual/misc/mako_hotplug_control/enabled
	echo 0 > /sys/devices/system/cpu/cpu0/rq-stats/hotplug_enable
	echo 0 > /sys/module/msm_hotplug/msm_enabled
	echo 0 > /sys/kernel/msm_mpdecision/conf/enabled
	echo 0 > /sys/devices/platform/msm_sleeper/enabled
	echo 0 > /sys/module/lazyplug/parameters/lazyplug_active
	echo 0 > /sys/kernel/alucard_hotplug/hotplug_enable
	echo 0 > /sys/module/blu_plug/parameters/enabled
	echo 1 > /sys/kernel/intelli_plug/intelli_plug_active
	echo 0 > /sys/kernel/intelli_plug/full_mode_profile
	echo 2 > /sys/kernel/intelli_plug/cpus_boosted;
	echo 2 > /sys/kernel/intelli_plug/min_cpus_online
	echo Y > /sys/module/cpu_boost/parameters/input_boost_enabled
	echo N > /sys/module/cpu_boost/parameters/hotplug_boost
	echo 1350000 > /sys/module/cpu_boost/parameters/input_boost_freq
	echo 70 > /sys/module/msm_thermal/parameters/limit_temp_degC
	echo 80 > /sys/module/msm_thermal/parameters/core_limit_temp_degC
	echo 450000000 > /sys/devices/platform/kgsl-3d0.0/kgsl/kgsl-3d0/max_gpuclk
	echo trustzone > /sys/devices/platform/kgsl-3d0.0/kgsl/kgsl-3d0/pwrscale/policy
	echo ondemand > /sys/devices/platform/kgsl-3d0.0/kgsl/kgsl-3d0/pwrscale/policy_config/trustzone/governor
	echo cfq > /sys/block/mmcblk0/queue/scheduler
	echo 128 > /sys/block/mmcblk0/queue/read_ahead_kb
	if [ -e /sys/block/mmcblk1/queue/scheduler ]; then
		echo cfq > /sys/block/mmcblk1/queue/scheduler
		echo 128 > /sys/block/mmcblk1/queue/read_ahead_kb
	fi
	echo None > $SYNAPSE_PRESET_DIR/.selected_preset_profile
	echo "Restoring Defaults"
	resetter
esac;
